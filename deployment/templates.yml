# Shared job templates for CI/CD pipelines
# Using GitLab Premium SaaS macOS runners

# Node.js job template with caching
.node_job:
  image: macos-15-xcode-16
  tags:
    - saas-macos-large-m2pro
  cache:
    key:
      files:
        - yarn.lock
    paths:
      - node_modules/
      - .yarn/cache/
    policy: pull-push
  before_script:
    - yarn install --frozen-lockfile

# Ruby/Fastlane job template with caching
.ruby_job:
  image: macos-15-xcode-16
  tags:
    - saas-macos-large-m2pro
  cache:
    key:
      files:
        - Gemfile.lock
    paths:
      - vendor/bundle/
    policy: pull-push
  before_script:
    - gem install bundler:2.4.22
    - bundle config set --local path 'vendor/bundle'
    - bundle install

# Combined Node + Ruby job template (for build jobs)
.build_job:
  image: macos-15-xcode-16
  tags:
    - saas-macos-large-m2pro
  cache:
    - key:
        files:
          - yarn.lock
      paths:
        - node_modules/
        - .yarn/cache/
      policy: pull-push
    - key:
        files:
          - Gemfile.lock
      paths:
        - vendor/bundle/
      policy: pull-push
  before_script:
    - yarn install --frozen-lockfile
    - gem install bundler:2.4.22
    - bundle config set --local path 'vendor/bundle'
    - bundle install
